<!DOCTYPE html>
<html>
<header>
    <title>Coffee Conneciton</title>
    <!-- Latest compiled and minified CSS & JS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://code.jquery.com/jquery.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>

    <!-- .css files -->
    <!-- <link rel="stylesheet" type="text/css" href="styling/reset.css"> -->
    <link rel="stylesheet" type="text/css" href="styling/survey.css">
    <style>
        img {
            max-width: 100%;
        }
    </style>
</header>

<body>
    <div id="questionnaire">
        <form>
            Your Name:
            <input type="text" name="firstname" id="name">
            <br>
            Photo URL:
            <input type="text" name="url" id="image">
            <br>
            <div class="question">
                <p>You are adventerous</p>
                Least  <input type="radio" class="options" name="rating1" value="1"> 1
                <input type="radio" class="options" name="rating1" value="2"> 2
                <input type="radio" class="options" name="rating1" value="3"> 3
                <input type="radio" class="options" name="rating1" value="4"> 4
                <input type="radio" class="options" name="rating1" value="5"> 5 Most
            </div>
            <div class="question">
                <p>You love Beyonce</p>
                Least  <input type="radio" class="options" name="rating2" value="1"> 1
                <input type="radio" class="options" name="rating2" value="2"> 2
                <input type="radio" class="options" name="rating2" value="3"> 3
                <input type="radio" class="options" name="rating2" value="4"> 4
                <input type="radio" class="options" name="rating2" value="5"> 5 Most
            </div>
            <div class="question">
                <p>You stand up as soon as the plane reaches the gate</p>
                Least  <input type="radio" class="options" name="rating3" value="1"> 1
                <input type="radio" class="options" name="rating3" value="2"> 2
                <input type="radio" class="options" name="rating3" value="3"> 3
                <input type="radio" class="options" name="rating3" value="4"> 4
                <input type="radio" class="options" name="rating3" value="5"> 5 Most
            </div>
            <div class="question">
                <p>You believe in Santa</p>
                Least  <input type="radio" class="options" name="rating4" value="1"> 1
                <input type="radio" class="options" name="rating4" value="2"> 2
                <input type="radio" class="options" name="rating4" value="3"> 3
                <input type="radio" class="options" name="rating4" value="4"> 4
                <input type="radio" class="options" name="rating4" value="5"> 5 Most
            </div>
            <div class="question">
                <p>You're the Grinch on Christmas</p>
                Least  <input type="radio" class="options" name="rating5" value="1"> 1
                <input type="radio" class="options" name="rating5" value="2"> 2
                <input type="radio" class="options" name="rating5" value="3"> 3
                <input type="radio" class="options" name="rating5" value="4"> 4
                <input type="radio" class="options" name="rating5" value="5"> 5 Most
            </div>
            <div class="question">
                <p>You chew with your mouth open</p>
                Least  <input type="radio" class="options" name="rating6" value="1"> 1
                <input type="radio" class="options" name="rating6" value="2"> 2
                <input type="radio" class="options" name="rating6" value="3"> 3
                <input type="radio" class="options" name="rating6" value="4"> 4
                <input type="radio" class="options" name="rating6" value="5"> 5 Most
            </div>
            <div class="question">
                <p>You don't wash your hands when you go to the bathroom</p>
                Least  <input type="radio" class="options" name="rating7" value="1"> 1
                <input type="radio" class="options" name="rating7" value="2"> 2
                <input type="radio" class="options" name="rating7" value="3"> 3
                <input type="radio" class="options" name="rating7" value="4"> 4
                <input type="radio" class="options" name="rating7" value="5"> 5 Most
            </div>
            <div class="question">
                <p>You love animals</p>
                Least  <input type="radio" class="options" name="rating8" value="1"> 1
                <input type="radio" class="options" name="rating8" value="2"> 2
                <input type="radio" class="options" name="rating8" value="3"> 3
                <input type="radio" class="options" name="rating8" value="4"> 4
                <input type="radio" class="options" name="rating8" value="5"> 5 Most
            </div>
            <div class="question">
                <p>The rules don't apply to you</p>
                Least  <input type="radio" class="options" name="rating9" value="1"> 1
                <input type="radio" class="options" name="rating9" value="2"> 2
                <input type="radio" class="options" name="rating9" value="3"> 3
                <input type="radio" class="options" name="rating9" value="4"> 4
                <input type="radio" class="options" name="rating9" value="5"> 5 Most
            </div>
            <div class="question">
                <p>You are a happy go lucky ray of sunshine</p>
                Least  <input type="radio" class="options" name="rating10" value="1"> 1
                <input type="radio" class="options" name="rating10" value="2"> 2
                <input type="radio" class="options" name="rating10" value="3"> 3
                <input type="radio" class="options" name="rating10" value="4"> 4
                <input type="radio" class="options" name="rating10" value="5"> 5 Most
            </div>

            <button type="button" id="SubmitButton">Submit</button>
        </form>
    </div>



    <!-- Modal -->
    <div class="modal fade" id="modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
            
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
            </div>
            <div class="modal-body">
            
            </div>
            <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            
            </div>
        </div>
        </div>
    </div>

    <script>
        //function when submit button is clicked
        $("#SubmitButton").on("click", function (e) {
            e.preventDefault();
            var newFriend = {
                name: $("#name").val().trim(),
                img: $("#image").val().trim(),
                scores: []
            }
            getValues(newFriend.scores);

            var imageIsURL = validateURL(newFriend.img);

            // validate all values for newFriend
            if (newFriend.scores.length === 10 && newFriend.name.length > 0 && newFriend.img.length > 0 && imageIsURL) {
                getMatch(newFriend);
            }

        });
        //validate all options for radio buttons
        function getValues(scores) {
            $(".question").each(function () {
                if ($(this).find("input:radio:checked").length) {
                    $(this).removeClass("error");
                    //numbers being added as strings still..why?
                    var answer = parseInt($(this).find("input:radio:checked").val());
                    scores.push(answer);

                }
                else {
                    $(this).addClass("error");

                }
            });
        }

        // check if image input is a url using rejax
        function validateURL(url) {
            var urlPattern = /(http|https):\/\/(\w+:{0,1}\w*)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%!\-\/]))?/;
            if (!urlPattern.test(url)) {
                $("#image").addClass("error");
                return false;
            } else {
                $("#image").removeClass("error");
                return true;
            }
        }

        function getMatch(newFriend) {
            console.log(newFriend);
            console.log("survey function is running");

            $.post("/api/friends", newFriend, function(res){
                
                console.log(res)
                // show results to user
                $(".modal-body").empty();
                
                var msg = $("<h2>").text("you match");
                var matchName = $("<h3>").text(res.name);
                var matchPhoto = $("<img>").attr("src", res.photo).attr("alt", "match image");

                $(".modal-body").append(msg, matchName, matchPhoto);

                $("#modal").modal("show");

                // clear form

                $(".options").each(function(){
                    $(this).val("").attr('checked', false);
                });
                $("#name").val("");
                $("#image").val("");

            
            });
        }

    </script>

</body>

</html>